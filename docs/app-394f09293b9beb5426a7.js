webpackJsonp([0],[,,function(t,n,e){"use strict";function i(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t)};n.Header={template:e(8),controller:r,bindings:{nationalities:"<",nationality:"<",onChange:"&",onClear:"&"}}},function(t,n,e){"use strict";function i(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function t(){i(this,t)};n.Table={template:e(9),controller:r,bindings:{columns:"<",rows:"<"}}},function(t,n,e){"use strict";function i(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.App=void 0;var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();e(7);var o=function(){function t(n){var e=this;i(this,t),this.model=n,this.model.getNationalities().then(function(t){e.nationalities=t}),this.model.getWritersAndBooks().then(this.setWritersAndBooks.bind(this)),this.writersColumns=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"nationality",label:"Nationality"},{key:"books",label:"Number of Books",onclick:this.onClickBooks.bind(this)}],this.booksColumns=[{key:"id",label:"ID"},{key:"title",label:"Title"},{key:"author",label:"Author"},{key:"year",label:"Year"}],this.filterWriter=null,this.filterNationality=null}return t.$inject=["model"],r(t,[{key:"onClickBooks",value:function(t){var n=this;this.filterWriter="Books of "+t.name,this.model.filterByWriter(t).then(function(t){n.books=t})}},{key:"onChangeNationality",value:function(t){this.filterWriter=null,this.filterNationality=t,this.model.filterByNationality(t).then(this.setWritersAndBooks.bind(this))}},{key:"onClearNationality",value:function(){this.filterWriter=null,this.filterNationality=null,this.model.getUnfiltered().then(this.setWritersAndBooks.bind(this))}},{key:"onClearWriterFilter",value:function(){this.filterWriter=null,this.filterNationality?this.model.filterByNationality(this.filterNationality).then(this.setWritersAndBooks.bind(this)):this.model.getUnfiltered().then(this.setWritersAndBooks.bind(this))}},{key:"setWritersAndBooks",value:function(t){this.writers=t.writers,this.books=t.books}}]),t}();n.App={template:e(10),controller:o}},function(t,n,e){"use strict";function i(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t){return{writers:l(t[0].data,t[1].data),books:a(t[1].data,t[0].data)}}function l(t,n){return t.map(function(t){return{id:t.id,name:t.first_name+" "+t.last_name,nationality:t.nationality,books:n.filter(function(n){return n.author_id===t.id}).length}})}function a(t,n){return t.map(function(t){var e=n.find(function(n){return n.id===t.author_id});return{id:t.id,title:t.title,author:e.first_name+" "+e.last_name,authorId:e.id,year:t.year}})}function s(t){var n=t.map(function(t){return t.nationality});return[].concat(i(new Set(n)))}Object.defineProperty(n,"__esModule",{value:!0}),n.Model=void 0;var u=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),c=e(11);n.Model=function(){function t(n,e,i,o){r(this,t),this.$http=n,this.$log=e,this.$q=i,this.$timeout=o,this.unfiltered=null,this.nationalitiesDeferred=i.defer()}return t.$inject=["$http","$log","$q","$timeout"],u(t,[{key:"getWritersAndBooks",value:function(){var t=this.$http.get(c.URL_WRITERS),n=this.$http.get(c.URL_BOOKS);return this.$q.all([t,n]).then(this.onGetWritersAndBooks.bind(this),this.onError.bind(this))}},{key:"getNationalities",value:function(){return this.nationalitiesDeferred.promise}},{key:"filterByWriter",value:function(t){var n=this,e=this.$q.defer();return this.$timeout(function(){var i=n.unfiltered.books.filter(function(n){return n.authorId===t.id});e.resolve(i)}),e.promise}},{key:"filterByNationality",value:function(t){var n=this,e=this.$q.defer();return this.$timeout(function(){var i=n.unfiltered.writers.filter(function(n){return n.nationality===t}),r=n.unfiltered.books.filter(function(t){return i.find(function(n){return t.authorId===n.id})});e.resolve({writers:i,books:r})}),e.promise}},{key:"getUnfiltered",value:function(){var t=this,n=this.$q.defer();return this.$timeout(function(){var e=[].concat(i(t.unfiltered.writers)),r=[].concat(i(t.unfiltered.books));n.resolve({writers:e,books:r})}),n.promise}},{key:"onGetWritersAndBooks",value:function(t){this.unfiltered=o(t);var n=s(this.unfiltered.writers);return this.nationalitiesDeferred.resolve(n),this.unfiltered}},{key:"onError",value:function(t){this.$log.error(t)}}]),t}()},,function(t,n){},function(t,n){t.exports='<header>\n    <span>\n        <a \n            ng-click="$ctrl.isOpen = !$ctrl.isOpen"\n            ng-bind="$ctrl.nationality || \'Filter by nationality\'"\n        ></a>\n        <ul ng-class="{open: $ctrl.isOpen}">\n            <li \n                ng-repeat="nationality in ::$ctrl.nationalities"\n                ng-bind="::nationality"\n                ng-click="$ctrl.onChange({nationality}); $ctrl.isOpen = false"\n                ng-class="{active: $ctrl.nationality === nationality}"\n            ></li>\n        </ul>\n    </span>\n    <button\n        ng-if="$ctrl.nationality" \n        ng-click="$ctrl.onClear()"\n        ng-bind="\'Clear\'"\n    ></button>\n</header>'},function(t,n){t.exports='<input type="search" ng-model="$ctrl.search" placeholder="Search in table"/>\n<table>\n    <thead>\n        <tr>\n            <th \n                ng-repeat="column in ::$ctrl.columns" \n                ng-bind="::column.label"\n            ></th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr ng-repeat="row in $ctrl.rows | filter: $ctrl.search">\n            <td \n                ng-repeat="column in ::$ctrl.columns" \n                ng-bind="row[column.key]" \n                ng-click="column.onclick(row)" \n                ng-class="{clickable: column.onclick}"\n            ></td>\n        </tr>\n    </tbody>\n</table>'},function(t,n){t.exports='<writers-header \n    nationalities="::$ctrl.nationalities"\n    nationality="$ctrl.filterNationality"\n    on-change="$ctrl.onChangeNationality(nationality)"\n    on-clear="$ctrl.onClearNationality()"\n></writers-header>\n<main>\n    <section>\n        <h2 ng-bind="\'Authors\'"></h2>\n        <writers-table \n            columns="::$ctrl.writersColumns" \n            rows="$ctrl.writers"\n        ></writers-table>\n    </section>\n    <section>\n        <h2 ng-bind="$ctrl.filterWriter || \'Books\'"></h2>\n        <button\n            ng-if="$ctrl.filterWriter" \n            ng-click="$ctrl.onClearWriterFilter()"\n            ng-bind="\'Clear\'"\n        ></button>\n        <writers-table \n            columns="::$ctrl.booksColumns" \n            rows="$ctrl.books"\n        ></writers-table>\n    </section>\n</main>\n'},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.URL_WRITERS="writers.json",n.URL_BOOKS="books.json"},function(t,n,e){"use strict";var i=e(0),r=function(t){return t&&t.__esModule?t:{default:t}}(i),o=e(4),l=e(5),a=e(2),s=e(3);r.default.module("writers",[]).service("model",l.Model).component("writersApp",o.App).component("writersHeader",a.Header).component("writersTable",s.Table)}],[12]);